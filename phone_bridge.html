<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>Ù¾Ø§ÛŒØ´ Ù¾Ù„ Ø¨Ø§ Ú¯ÙˆØ´ÛŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Tahoma;
            padding: 20px;
            text-align: center;
            background: #f0f8ff;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
        }
        .log {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: right;
            direction: rtl;
            height: 200px;
            overflow-y: auto;
        }
        .status {
            font-size: 20px;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .on-bridge { background: #d4edda; color: #155724; }
        .off-bridge { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Ù¾Ø§ÛŒØ´ Ø³Ù„Ø§Ù…Øª Ù¾Ù„ Ø¨Ø§ Ú¯ÙˆØ´ÛŒ</h1>
        
        <div id="status" class="status off-bridge">
            ğŸ” Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª...
        </div>

        <button onclick="startMonitoring()">Ø´Ø±ÙˆØ¹ Ù¾Ø§ÛŒØ´ Ø®ÙˆØ¯Ú©Ø§Ø±</button>
        <button onclick="stopMonitoring()">ØªÙˆÙ‚Ù</button>

        <div class="log" id="log">
            Ù„Ø§Ú¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:<br>
        </div>

        <div>
            <h3>Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ:</h3>
            <div id="location">Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...</div>
            <div id="acceleration">Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬: Ø¢Ù…Ø§Ø¯Ù‡</div>
        </div>
    </div>

    <script>
        let isMonitoring = false;
        let watchId = null;
        let bridgeData = [];

        function startMonitoring() {
            if (!isMonitoring) {
                isMonitoring = true;
                addLog("Ù¾Ø§ÛŒØ´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø´Ø±ÙˆØ¹ Ø´Ø¯");
                
                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª
                if (navigator.geolocation) {
                    watchId = navigator.geolocation.watchPosition(
                        handlePosition,
                        handleError,
                        { 
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );
                }

                // Ø´Ø±ÙˆØ¹ Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬
                startAccelerometer();
            }
        }

        function stopMonitoring() {
            if (isMonitoring) {
                isMonitoring = false;
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                }
                addLog("Ù¾Ø§ÛŒØ´ Ù…ØªÙˆÙ‚Ù Ø´Ø¯");
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                saveData();
            }
        }

        function handlePosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const speed = position.coords.speed || 0;
            
            document.getElementById('location').innerHTML = 
                `Ø¹Ø±Ø¶: ${lat.toFixed(6)}<br>Ø·ÙˆÙ„: ${lng.toFixed(6)}<br>Ø³Ø±Ø¹Øª: ${(speed * 3.6).toFixed(1)} km/h`;

            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø±ÙˆÛŒ Ù¾Ù„ Ù‡Ø³ØªÛŒ ÛŒØ§ Ù†Ù‡
            checkIfOnBridge(lat, lng);
        }

        function checkIfOnBridge(lat, lng) {
            // Ù¾Ù„â€ŒÙ‡Ø§ÛŒ ØªØ¨Ø±ÛŒØ² - Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
            const bridges = [
                {name: "Ù¾Ù„ Ø´Ù‡ÛŒØ¯ Ø¨Ù‡Ø´ØªÛŒ", lat: 38.0815, lng: 46.2917, radius: 0.001},
                {name: "Ù¾Ù„ Ø±Ø§Ù‡ Ø¢Ù‡Ù†", lat: 38.0850, lng: 46.3050, radius: 0.001}
            ];

            let onBridge = false;
            let bridgeName = "";

            for (let bridge of bridges) {
                const distance = Math.sqrt(
                    Math.pow(lat - bridge.lat, 2) + 
                    Math.pow(lng - bridge.lng, 2)
                );
                
                if (distance < bridge.radius) {
                    onBridge = true;
                    bridgeName = bridge.name;
                    break;
                }
            }

            if (onBridge) {
                document.getElementById('status').className = 'status on-bridge';
                document.getElementById('status').innerHTML = `ğŸ—ï¸ Ø±ÙˆÛŒ ${bridgeName} Ù‡Ø³ØªÛŒØ¯`;
                collectBridgeData(lat, lng, bridgeName);
            } else {
                document.getElementById('status').className = 'status off-bridge';
                document.getElementById('status').innerHTML = 'ğŸ” Ø¯Ø± Ø¬Ø§Ø¯Ù‡ Ù…Ø¹Ù…ÙˆÙ„ÛŒ';
            }
        }

        function startAccelerometer() {
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', function(event) {
                    const accel = event.acceleration;
                    if (accel) {
                        document.getElementById('acceleration').innerHTML = 
                            `Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬:<br>X: ${accel.x?.toFixed(2) || 0}<br>Y: ${accel.y?.toFixed(2) || 0}<br>Z: ${accel.z?.toFixed(2) || 0}`;
                    }
                });
            } else {
                document.getElementById('acceleration').innerHTML = 'Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª';
            }
        }

        function collectBridgeData(lat, lng, bridgeName) {
            const data = {
                timestamp: new Date().toISOString(),
                bridge: bridgeName,
                location: { lat, lng },
                acceleration: getAccelerationData(),
                type: 'bridge_crossing'
            };
            
            bridgeData.push(data);
            addLog(`ğŸ“Š Ø¯Ø§Ø¯Ù‡ Ø§Ø² ${bridgeName} Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯`);
        }

        function getAccelerationData() {
            // Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø´ØªØ§Ø¨â€ŒØ³Ù†Ø¬ Ù…ÛŒØ§Ø¯
            return {
                x: (Math.random() * 2 - 1).toFixed(3),
                y: (Math.random() * 2 - 1).toFixed(3),
                z: (9.8 + Math.random() * 0.4 - 0.2).toFixed(3)
            };
        }

        function handleError(error) {
            addLog(`Ø®Ø·Ø§ Ø¯Ø± Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: ${error.message}`);
        }

        function addLog(message) {
            const log = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            log.innerHTML = `${time} - ${message}<br>` + log.innerHTML;
        }

        function saveData() {
            if (bridgeData.length > 0) {
                const dataStr = JSON.stringify(bridgeData, null, 2);
                const blob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'bridge_data.json';
                a.click();
                
                addLog(`ğŸ’¾ ${bridgeData.length} Ø¯Ø§Ø¯Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                bridgeData = [];
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        window.onload = function() {
            addLog("Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø±ÙˆÛŒ 'Ø´Ø±ÙˆØ¹ Ù¾Ø§ÛŒØ´ Ø®ÙˆØ¯Ú©Ø§Ø±' Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.");
        };
    </script>
</body>
</html>